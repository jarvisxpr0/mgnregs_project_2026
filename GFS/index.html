<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MGNREGA District Performance Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Font Inter (used by Tailwind) -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* Utility classes for dynamic colors need to be safe-listed for Tailwind JIT in CDN mode */
        .bg-red-600, .bg-yellow-500, .bg-green-600, .border-red-600\/50, .border-yellow-500\/50, .border-green-600\/50, .text-red-600, .text-yellow-500, .text-green-600, .border-green-500, .border-red-500, .border-yellow-500 {
            /* This section helps ensure dynamic classes are available */
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- The root element where the React app will be mounted -->
    <div id="root">
        <div class="flex items-center justify-center min-h-screen">
            <div class="animate-pulse text-gray-600 text-xl">Loading Dashboard...</div>
        </div>
    </div>

    <!-- 1. Load React, ReactDOM, and Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 2. Load Firebase Services (These expose global functions like initializeApp, getAuth, etc.) -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>


    <!-- 3. Define global Firebase configuration variables (MANDATORY for Canvas environment) -->
    <script>
        // These variables are typically injected by the hosting environment
        window.__firebase_config = '{"apiKey": "mock_key", "authDomain": "mock_domain", "projectId": "mock_id", "storageBucket": "mock_bucket", "messagingSenderId": "mock_sender", "appId": "mock_app"}';
        window.__app_id = 'mgnrega-dashboard-app';
        window.__initial_auth_token = 'mock-auth-token-12345';
    </script>

    <!-- 4. Embed the React Component (JSX code) and mounting logic -->
    <script type="text/babel">
        // --- React Hook Access ---
        const { useState, useEffect, useMemo, useCallback } = React;
        
        // --- Firebase Function Access ---
        const initializeApp = window.initializeApp;
        const getAuth = window.getAuth;
        const signInAnonymously = window.signInAnonymously;
        const signInWithCustomToken = window.signInWithCustomToken;
        const getFirestore = window.getFirestore;
        const doc = window.doc;
        const onSnapshot = window.onSnapshot;
        const setDoc = window.setDoc;

        // --- Icon Imports (Simulated using functional components for single-file design) ---
        const UsersIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
        const CalendarIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m9 16h6"/></svg>);
        const DollarSignIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>);
        const GaugeIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 14c1.45-1.74 3-4.32 3-5.83 0-2.43-1.5-4.42-3.48-4.42-1.99 0-3.5 2-3.5 4.42 0 1.51 1.55 4.09 3 5.83"/><path d="M3 13.91V22h18v-8.09"/></svg>);
        const LocateIcon = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="2" x2="5" y1="12" y2="12"/><line x1="19" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="5"/><line x1="12" x2="12" y1="19" y2="22"/><circle cx="12" cy="12" r="7"/></svg>);

        // --- Configuration and Mock Data ---
        const MOCK_STATES_DISTRICTS = {
            'UTTAR PRADESH': [
                { name: 'AGRA', lat: 27.17, lon: 78.04 },
                { name: 'KANPUR', lat: 26.44, lon: 80.33 },
                { name: 'LUCKNOW', lat: 26.84, lon: 80.94 },
                { name: 'VARANASI', lat: 25.31, lon: 82.97 },
                { name: 'GORAKHPUR', lat: 26.76, lon: 83.37 },
            ],
            'BIHAR': [
                { name: 'PATNA', lat: 25.59, lon: 85.13 },
                { name: 'GAYA', lat: 24.79, lon: 85.0 },
                { name: 'MUZAFFARPUR', lat: 26.12, lon: 85.39 },
            ],
            'RAJASTHAN': [
                { name: 'JAIPUR', lat: 26.91, lon: 75.79 },
                { name: 'UDAIPUR', lat: 24.58, lon: 73.68 },
            ],
            'MAHARASHTRA': [
                { name: 'MUMBAI', lat: 19.07, lon: 72.87 },
                { name: 'PUNE', lat: 18.52, lon: 73.85 },
            ]
        };

        const ALL_DISTRICTS = Object.values(MOCK_STATES_DISTRICTS).flat();

        const mockPerformanceHistory = (districtName) => {
            const nameHash = districtName.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const base = 0.5 + (nameHash % 10) / 15 + Math.random() * 0.1;

            const data = [];
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];
            for (let i = 0; i < months.length; i++) {
                const factor = base + (Math.random() - 0.5) * 0.3;
                data.push({
                    month: months[i],
                    householdsWorked: Math.round(factor * 10) / 10,
                    avgDaysWork: Math.floor(factor * 20) + 10,
                    womenParticipation: Math.floor(factor * 15) + 45,
                    fundsUtilized: Math.round(factor * 50) / 10,
                });
            }
            return data;
        };

        const mockAggregateHistory = () => {
            const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun"];
            const allDistrictNames = ALL_DISTRICTS.map(d => d.name);

            const allDistrictData = allDistrictNames.map(name => mockPerformanceHistory(name));

            const aggregatedData = months.map((month, monthIndex) => {
                let totalHouseholds = 0;
                let totalAvgDays = 0;
                let totalWomenParticipation = 0;
                let totalFundsUtilized = 0;
                const numDistricts = allDistrictData.length;

                allDistrictData.forEach(history => {
                    const monthlyData = history[monthIndex];
                    if (monthlyData) {
                        totalHouseholds += monthlyData.householdsWorked;
                        totalAvgDays += monthlyData.avgDaysWork;
                        totalWomenParticipation += monthlyData.womenParticipation;
                        totalFundsUtilized += monthlyData.fundsUtilized;
                    }
                });

                return {
                    month: month,
                    householdsWorked: Math.round(totalHouseholds * 10) / 10,
                    fundsUtilized: Math.round(totalFundsUtilized * 10) / 10,
                    avgDaysWork: Math.round((totalAvgDays / numDistricts) * 10) / 10,
                    womenParticipation: Math.round((totalWomenParticipation / numDistricts) * 10) / 10,
                };
            });

            return aggregatedData;
        };

        // --- Firebase Initialization and Auth ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-mgnrega-app';
        
        // Initialize Firebase services using global functions
        const app = initializeApp ? initializeApp(firebaseConfig) : null;
        const auth = app && getAuth ? getAuth(app) : null;
        const db = app && getFirestore ? getFirestore(app) : null;

        // --- Helper Functions ---

        const determineStatus = (data) => {
            if (!data || data.length === 0) return { status: 'LOW', text: 'Data Not Found / डेटा नहीं मिला', color: 'red-600', icon: '❓' };

            const latest = data[data.length - 1];

            let score = 0;
            const isAllStates = latest.isAllStates;

            let householdGoal = isAllStates ? 5.0 : 0.9;
            let daysGoal = isAllStates ? 25 : 28;
            let womenGoal = isAllStates ? 53 : 55;

            if (latest.householdsWorked > householdGoal) score += 2;
            else if (latest.householdsWorked > householdGoal * 0.75) score += 1;

            if (latest.avgDaysWork > daysGoal) score += 2;
            else if (latest.avgDaysWork > daysGoal * 0.8) score += 1;

            if (latest.womenParticipation > womenGoal) score += 2;
            else if (latest.womenParticipation > womenGoal * 0.9) score += 1;

            if (score >= 4) {
                return { status: 'GOOD', text: 'Good / अच्छा', color: 'green-600', icon: '✅' };
            } else if (score >= 2) {
                return { status: 'DEVELOPING', text: 'Developing / सुधार', color: 'yellow-500', icon: '⚠️' };
            } else {
                return { status: 'NEEDS_WORK', text: 'Needs Improvement / कमजोर', color: 'red-600', icon: '❌' };
            }
        };

        // --- Custom Components ---

        const DataCard = ({ icon: Icon, title, hindiTitle, value, unit, statusColor }) => (
            <div className={`p-4 bg-white rounded-xl shadow-lg border-b-4 border-${statusColor} transition hover:shadow-xl`}>
                <div className="flex items-center space-x-3 mb-2">
                    <Icon className={`w-6 h-6 text-${statusColor}`} />
                    <h3 className="text-sm font-semibold text-gray-700 uppercase tracking-wider">{title}</h3>
                </div>
                <p className="text-2xl md:text-3xl font-bold text-gray-900">{value} <span className="text-lg font-medium text-gray-500">{unit}</span></p>
                <p className="text-xs text-gray-500 mt-1">{hindiTitle}</p>
            </div>
        );

        const LineBarChart = ({ data, metricKey, title }) => {
            const values = data.map(d => d[metricKey]);
            const labels = data.map(d => d.month);
            const maxValue = Math.max(...values) * 1.1;

            return (
                <div className="bg-white p-4 md:p-6 rounded-xl shadow-lg h-80 flex flex-col">
                    <h3 className="text-base font-bold text-gray-800 mb-4">{title}</h3>
                    <div className="flex-grow flex items-end space-x-2 md:space-x-4 border-l border-b border-gray-300 p-2">
                        {values.map((value, index) => {
                            const height = (value / maxValue) * 90;
                            const color = height > 70 ? 'bg-green-500' : height > 40 ? 'bg-yellow-500' : 'bg-red-500';
                            return (
                                <div key={index} className="flex flex-col items-center flex-1 h-full justify-end group min-w-[30px]">
                                    <div className="text-xs text-gray-600 mb-1 group-hover:visible invisible">
                                        {value}
                                    </div>
                                    <div
                                        style={{ height: `${height}%` }}
                                        className={`w-full max-w-[40px] ${color} rounded-t-sm transition-all duration-300 ease-out`}
                                        title={`${labels[index]}: ${value}`}
                                    ></div>
                                    <div className="text-xs font-medium text-gray-600 mt-1">{labels[index]}</div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const ALL_STATES_KEY = 'ALL_STATES';
            const ALL_DISTRICTS_KEY = 'ALL_DISTRICTS';
            const DEFAULT_STATE = 'UTTAR PRADESH';
            const DEFAULT_DISTRICT = 'LUCKNOW';

            const [selectedState, setSelectedState] = useState(DEFAULT_STATE);
            const [selectedDistrict, setSelectedDistrict] = useState(DEFAULT_DISTRICT);
            const [districtData, setDistrictData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [authReady, setAuthReady] = useState(false);
            const [geoLoading, setGeoLoading] = useState(true);
            const [geoError, setGeoError] = useState(null);

            const districtsForState = useMemo(() => {
                if (selectedState === ALL_STATES_KEY) {
                    return [{ name: ALL_DISTRICTS_KEY, lat: 0, lon: 0 }];
                }
                return MOCK_STATES_DISTRICTS[selectedState] || [];
            }, [selectedState]);

            // 1. Firebase Auth Initialization: Ensures a user is signed in.
            useEffect(() => {
                // If the 'auth' object is unavailable (e.g., in a restrictive environment), mark as ready immediately.
                if (!auth) {
                    setAuthReady(true);
                    return;
                }

                let isMounted = true;

                const handleAuth = async () => {
                    let initialUser = auth.currentUser;

                    if (typeof __initial_auth_token !== 'undefined' && !initialUser) {
                        try {
                            // 1. Try Custom Token Sign-in
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } catch (e) {
                            console.error("Custom token sign in failed. Falling back to anonymous:", e);
                            try {
                                // 2. Fallback to Anonymous Sign-in
                                await signInAnonymously(auth);
                            } catch (error) {
                                console.error("Anonymous sign in failed:", error);
                            }
                        }
                    }

                    if (isMounted) {
                        setAuthReady(true); // Mark auth process as complete regardless of success
                    }
                };

                handleAuth();

                // Cleanup function
                return () => {
                    isMounted = false;
                };
            }, [auth]);

            // 2. Geolocation for initial state/district selection
            useEffect(() => {
                if (navigator.geolocation && geoLoading) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const userLat = position.coords.latitude;
                        const userLon = position.coords.longitude;
                        let closestDistrict = ALL_DISTRICTS[0];
                        let minDistance = Infinity;

                        ALL_DISTRICTS.forEach(district => {
                            const dist = Math.sqrt(Math.pow(district.lat - userLat, 2) + Math.pow(district.lon - userLon, 2));
                            if (dist < minDistance) {
                                minDistance = dist;
                                closestDistrict = district;
                            }
                        });

                        const closestState = Object.keys(MOCK_STATES_DISTRICTS).find(state =>
                            MOCK_STATES_DISTRICTS[state].some(d => d.name === closestDistrict.name)
                        ) || DEFAULT_STATE;

                        setSelectedState(closestState);
                        setSelectedDistrict(closestDistrict.name);
                        setGeoLoading(false);

                    }, (error) => {
                        setGeoError('Could not determine your location. Defaulting to Uttar Pradesh.');
                        setGeoLoading(false);
                    }, { timeout: 5000 });
                } else {
                    setGeoLoading(false);
                }
            }, []);

            // 3. Handle State Change: Reset District to the first one in the new state, or set to ALL_DISTRICTS
            useEffect(() => {
                if (selectedState === ALL_STATES_KEY) {
                    setSelectedDistrict(ALL_DISTRICTS_KEY);
                    return;
                }

                if (districtsForState.length > 0) {
                    if (!districtsForState.some(d => d.name === selectedDistrict)) {
                         setSelectedDistrict(districtsForState[0].name);
                    }
                }
            }, [selectedState, districtsForState]);

            // 4. Firestore Data Fetch or Local Aggregation (FIXED FOR FALLBACK)
            useEffect(() => {
                if (!selectedState || !selectedDistrict) {
                    return;
                }

                setLoading(true);
                let unsubscribe; 

                // A. Handle ALL STATES / NATIONAL AGGREGATION VIEW
                if (selectedState === ALL_STATES_KEY) {
                    const nationalData = mockAggregateHistory().map(d => ({
                        ...d,
                        isAllStates: true
                    }));
                    setDistrictData(nationalData);
                    setLoading(false);
                    return;
                }

                // B. Check if we can use Firestore
                const canUseFirestore = db && authReady && doc && onSnapshot && setDoc;

                if (!canUseFirestore) {
                    // FALLBACK: If Firebase/Auth is not fully ready or functions are missing, use local mock data
                    console.warn("Firestore/Auth not ready or functions missing. Using local mock data fallback.");
                    setDistrictData(mockPerformanceHistory(selectedDistrict));
                    setLoading(false);
                    return;
                }

                // C. Firestore Operation (Only runs if canUseFirestore is true)
                try {
                    const docId = `${selectedState.substring(0, 2).toUpperCase()}_${selectedDistrict.toUpperCase()}`;
                    const dataPath = `/artifacts/${appId}/public/data/mgnrega_performance`;
                    const districtRef = doc(db, dataPath, docId);

                    unsubscribe = onSnapshot(districtRef, (docSnap) => {
                        if (docSnap.exists() && docSnap.data().performance) {
                            setDistrictData(docSnap.data().performance);
                            console.log(`Loaded data for ${docId} from Firestore.`);
                        } else {
                            console.log(`No cached data found for ${docId}. Simulating data write...`);
                            
                            const mockData = {
                                districtName: selectedDistrict,
                                stateName: selectedState,
                                performance: mockPerformanceHistory(selectedDistrict)
                            };

                            setDoc(districtRef, mockData).then(() => {
                                console.log(`Simulated initial write for ${docId}. onSnapshot should trigger reload.`);
                            }).catch(err => {
                                console.error("Simulated write failed, using local mock:", err);
                                setDistrictData(mockData.performance); 
                            });
                        }
                        setLoading(false);
                    }, (error) => {
                        console.error("Firestore data snapshot failed. Using local mock:", error);
                        setDistrictData(mockPerformanceHistory(selectedDistrict));
                        setLoading(false);
                    });
                } catch (e) {
                    console.error("Critical error setting up Firestore listener. Using local mock:", e);
                    setDistrictData(mockPerformanceHistory(selectedDistrict));
                    setLoading(false);
                }

                return () => {
                    if (unsubscribe) unsubscribe();
                };
            }, [db, authReady, selectedState, selectedDistrict, ALL_STATES_KEY]); 

            // Derived State for Current Month
            const currentPerformance = useMemo(() => {
                if (!districtData || districtData.length === 0) return null;
                return districtData[districtData.length - 1];
            }, [districtData]);

            const status = useMemo(() => determineStatus(districtData), [districtData]);

            const handleStateChange = (e) => {
                const newState = e.target.value;
                setSelectedState(newState);
            };

            const handleDistrictChange = (e) => {
                setSelectedDistrict(e.target.value);
            };

            if (loading || geoLoading) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gray-50">
                        <div className="text-center p-8 bg-white rounded-xl shadow-xl">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-red-500 mx-auto mb-4"></div>
                            <p className="text-xl font-bold text-gray-700">Loading Data...</p>
                            <p className="text-gray-500 mt-2">Connecting to secure government data cache.</p>
                        </div>
                    </div>
                );
            }

            const isAllStatesView = selectedState === ALL_STATES_KEY;
            const householdUnit = isAllStatesView ? 'Crores' : 'Lakhs';
            const fundsUnit = isAllStatesView ? 'Thousands Cr' : 'Cr';
            const locationDisplay = isAllStatesView ? 'National Aggregation' : `${selectedState} - ${selectedDistrict}`;


            return (
                <div className="min-h-screen bg-gray-50 font-sans p-4 md:p-8">
                    {/* Header */}
                    <header className="bg-white p-4 md:p-6 rounded-xl shadow-2xl mb-6 flex flex-col md:flex-row justify-between items-center">
                        <h1 className="text-xl md:text-3xl font-extrabold text-red-700">
                            MGNREGA Performance / मनरेगा प्रगति
                        </h1>
                        <div className="mt-4 md:mt-0 flex items-center space-x-2">
                            <LocateIcon className="w-5 h-5 text-gray-500" />
                            <span className="text-sm font-medium text-gray-600">
                                 {isAllStatesView ? 'Viewing National Data' : `User ID: ${auth?.currentUser?.uid || 'Anon'}`}
                            </span>
                        </div>
                    </header>

                    {/* State and District Selector */}
                    <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-xl shadow-md flex flex-col space-y-4 md:space-y-0 md:flex-row items-start md:items-center justify-between">
                        <div className="flex flex-col md:flex-row items-start md:items-center space-y-3 md:space-y-0 md:space-x-6 w-full">
                            {/* State Selector */}
                            <div className="flex items-center space-x-2">
                                <label htmlFor="state-select" className="text-lg font-bold text-red-800 whitespace-nowrap">
                                    Select State / राज्य चुनें:
                                </label>
                                <select
                                    id="state-select"
                                    value={selectedState}
                                    onChange={handleStateChange}
                                    className="p-2 border-2 border-red-300 rounded-lg text-lg font-semibold bg-white shadow-sm focus:border-red-500 focus:ring-red-500 w-full md:w-48"
                                >
                                    <option value={ALL_STATES_KEY}>ALL STATES / पूरे राज्य</option>
                                    {Object.keys(MOCK_STATES_DISTRICTS).map(state => (
                                        <option key={state} value={state}>{state}</option>
                                    ))}
                                </select>
                            </div>

                            {/* District Selector */}
                            <div className="flex items-center space-x-2">
                                <label htmlFor="district-select" className="text-lg font-bold text-red-800 whitespace-nowrap">
                                    Select District / जिला चुनें:
                                </label>
                                <select
                                    id="district-select"
                                    value={selectedDistrict}
                                    onChange={handleDistrictChange}
                                    disabled={isAllStatesView}
                                    className={`p-2 border-2 rounded-lg text-lg font-semibold bg-white shadow-sm focus:ring-red-500 w-full md:w-48 ${isAllStatesView ? 'bg-gray-200 text-gray-500 border-gray-300' : 'border-red-300 focus:border-red-500'}`}
                                >
                                    {districtsForState.map(d => (
                                        <option key={d.name} value={d.name}>{d.name}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        <p className="text-sm text-gray-600 mt-3 md:mt-0 md:ml-4 font-semibold">
                            {geoError && !isAllStatesView
                                ? `*Geo-location failed: ${geoError}`
                                : `*Currently viewing: ${locationDisplay}`}
                        </p>
                    </div>

                    {/* Main Content: Current Status and KPIs */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        {/* Status Card (Traffic Light) */}
                        <div className={`lg:col-span-1 p-6 flex flex-col items-center justify-center rounded-xl shadow-2xl transition duration-500 border-8 border-${status.color}/50`}
                             style={{ backgroundColor: `rgba(220, 220, 220, 0.5)` }}>
                            <p className="text-4xl">{status.icon}</p>
                            <h2 className="text-xl md:text-2xl font-bold text-gray-800 mt-2">Latest Performance Status</h2>
                            <p className="text-sm text-gray-500 mb-4">(Last Month's Report)</p>
                            <div className={`px-8 py-4 rounded-full font-extrabold text-white text-3xl md:text-4xl shadow-xl transition-transform duration-300 hover:scale-105 bg-${status.color}`}>
                                {status.text}
                            </div>
                        </div>

                        {/* Key Performance Indicators (KPIs) */}
                        <div className="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <DataCard
                                icon={UsersIcon}
                                title={`Households Worked (Total ${isAllStatesView ? 'National' : 'District'})`}
                                hindiTitle={`काम मिला (${householdUnit} परिवार)`}
                                value={currentPerformance ? currentPerformance.householdsWorked : '-'}
                                unit={householdUnit}
                                statusColor={currentPerformance && currentPerformance.householdsWorked > 0.6 ? 'green-500' : 'red-500'}
                            />
                            <DataCard
                                icon={CalendarIcon}
                                title="Avg. Work Days (Per Household)"
                                hindiTitle="औसत काम के दिन"
                                value={currentPerformance ? currentPerformance.avgDaysWork : '-'}
                                unit="Days"
                                statusColor={currentPerformance && currentPerformance.avgDaysWork > 20 ? 'green-500' : 'yellow-500'}
                            />
                            <DataCard
                                icon={GaugeIcon}
                                title="Women Participation (Average)"
                                hindiTitle="महिला भागीदारी"
                                value={currentPerformance ? currentPerformance.womenParticipation : '-'}
                                unit="%"
                                statusColor={currentPerformance && currentPerformance.womenParticipation > 50 ? 'green-500' : 'yellow-500'}
                            />
                            <DataCard
                                icon={DollarSignIcon}
                                title={`Funds Utilized (Total ${isAllStatesView ? 'National' : 'District'})`}
                                hindiTitle={`पैसा खर्च (${fundsUnit})`}
                                value={currentPerformance ? currentPerformance.fundsUtilized : '-'}
                                unit={fundsUnit}
                                statusColor={currentPerformance && currentPerformance.fundsUtilized > 1.0 ? 'green-500' : 'yellow-500'}
                            />
                        </div>
                    </div>

                    {/* Historical Charts (Comparatives) */}
                    <h2 className="text-2xl font-bold text-gray-800 mb-4 mt-8">Past Performance / पिछला प्रदर्शन</h2>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {districtData.length > 0 && (
                            <>
                                <LineBarChart
                                    data={districtData}
                                    metricKey="householdsWorked"
                                    title={`Households Provided Work (${householdUnit}) / कितने परिवारों को काम मिला`}
                                />
                                <LineBarChart
                                    data={districtData}
                                    metricKey="avgDaysWork"
                                    title="Average Days of Work Provided / औसत काम के दिन"
                                />
                            </>
                        )}
                    </div>

                    {/* Footer with Disclaimer for Low-Literacy */}
                    <footer className="mt-12 p-4 text-center text-xs text-gray-500 border-t border-gray-200">
                        <p>Data Source: Government Open Data (Simulated for demonstration from secure cache). The data is pre-processed for simplicity and fast loading.</p>
                        <p className="mt-1 font-semibold text-gray-700">Disclaimer: This information is for general public awareness and comparison only. For official records, please contact your local Gram Panchayat office.</p>
                    </footer>

                </div>
            );
        };

        // Standard React mounting process
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>